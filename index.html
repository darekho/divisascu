<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DivisasCU</title>
<meta name="description" content="Mercado Informal de Divisas en Cuba.">
<meta name="keywords" content="divisas cuba, cambio moneda cuba, cup a usd, euro cuba, mlc, mercado informal cuba, tasa cambio cuba, dollar cuba, el toque, el toke, eltoque">
<meta name="author" content="divisasCU">
<meta name="robots" content="index, follow">

<!-- Open Graph General (Facebook, LinkedIn, Pinterest, etc.) -->
<meta property="og:title" content="divisasCU ‚Äî Mercado Informal de Divisas en Cuba">
<meta property="og:description" content="üí∞ Tasas de cambio actualizadas en Cuba. Calculadora de CUP a USD, EUR, MLC. Mercado informal cubano en tiempo real.">
<meta property="og:image" content="https://divisascu.vercel.app/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/png">
<meta property="og:url" content="https://divisascu.vercel.app/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="divisasCU">
<meta property="og:locale" content="es_ES">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large image">
<meta name="twitter:title" content="divisasCU ‚Äî Mercado Informal de Divisas en Cuba">
<meta name="twitter:description" content="üí∞ Tasas de cambio actualizadas en Cuba. Calculadora de CUP a USD, EUR, MLC. Mercado informal cubano en tiempo real.">
<meta name="twitter:image" content="https://divisascu.vercel.app/og-image.png">
<meta name="twitter:site" content="@divisascu">
<meta name="twitter:creator" content="@divisascu">

<!-- Google Site Verification -->
<meta name="google-site-verification" content="4vqHwIIaaa0ltOklX277H7_WPZGlyX7cLtiJqbthnJk" />

<!-- Favicon actualizado -->
<link rel="icon" href="https://divisascu.vercel.app/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="https://divisascu.vercel.app/favicon.ico">
<link rel="manifest" href="manifest.json">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Flex:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --brand:#0a2a6a;
  --gradient-start:#1a2f6b;
  --gradient-end:#2c5282;
  --accent:#ff6b35;
  --up:#059669;
  --down:#dc2626;
  --neutral:#6b7280;
  --bg:#f8fafc;
  --card:#fff;
  --muted:#64748b;
  --tab-active-bg:#22c55e;
  --tab-inactive-bg:#e2e8f0;
  --tab-active-color:#fff;
  --tab-inactive-color:#111;
  --text-primary:#111;
  --text-secondary:#334155;
  --purple-primary: #6b46c1;
  --purple-light: #9f7aea;
  --purple-bg: rgba(107, 70, 193, 0.15);
}

[data-theme="dark"] {
  --bg:#0f172a;
  --card:#1e293b;
  --muted:#94a3b8;
  --text-primary:#f1f5f9;
  --text-secondary:#cbd5e1;
  --tab-inactive-bg:#334155;
  --tab-inactive-color:#f1f5f9;
  --rate-color:#60a5fa;
  --purple-primary: #9f7aea;
  --purple-light: #d6bcfa;
  --purple-bg: rgba(159, 122, 234, 0.15);
}

*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',system-ui,Arial;background:var(--bg);color:var(--text-primary);transition:background 0.3s, color 0.3s;}

/* HEADER MODERNIZADO */
header {
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  color: #ffff;
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  position: relative;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  border-radius: 0 0 16px 16px;
  margin: 0 12px;
  max-width: calc(100% - 24px);
}

.logo {
  display: flex;
  align-items: center;
  gap: 4px;
  font-weight: 800;
  z-index: 10;
}

.logo-img {
  width: 50px;
  height: 50px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 20px;
  color: var(--brand);
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s ease;
}

.logo-img:hover {
  transform: rotate(10deg);
}

.logo-img img {
  width: 50px;
  height: 50px;
  object-fit: contain;
}

.logo .name {
  font-size: 1.5rem;
  letter-spacing: -0.5px;
  background: linear-gradient(to right, #fff, #e0e7ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}

.logo .small {
  font-size: 0.70rem;
  color: #e0e7ff;
  opacity: 0.9;
  font-weight: 500;
}

.controls {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.clock-box {
  text-align: center;
  margin-right: 0;
}

.clock-box .title {
  font-size: 0.7rem;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: none;
}

.clock-box .clock {
  background: rgba(255, 255, 255, 0.15);
  padding: 8px 16px;
  border-radius: 12px;
  font-family: 'Inter', monospace;
  font-weight: 700;
  font-size: 1.1rem;
  color: #fff;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.clock-box .clock .blink {
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

/* Bot√≥n flotante de usuarios en l√≠nea */
.floating-users {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  align-items: center;
  background: rgba(34, 197, 94, 0.85);
  color: white;
  padding: 10px 15px;
  border-radius: 50px;
  font-size: 0.9rem;
  font-weight: 600;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
  cursor: default;
  border: none;
}

.floating-users:hover {
  background: rgba(34, 197, 94, 0.95);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
}

.floating-users i {
  margin-right: 8px;
  font-size: 1rem;
}

.user-count {
  font-weight: 700;
  font-size: 1.1rem;
  margin-left: 5px;
  position: relative;
}

/* Efecto de pulso en el fondo del n√∫mero */
.user-count::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  z-index: -1;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.7;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.2);
    opacity: 0.4;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.7;
  }
}

.wrap {
  max-width: 480px;
  margin: 16px auto;
  padding: 0 12px;
}

/* Banner de desarrollo */
.dev-banner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: linear-gradient(90deg, #ff6b35, #f7931e, #ff6b35);
  color: white;
  padding: 10px 15px;
  border-radius: 12px;
  margin-bottom: 14px;
  font-weight: 600;
  font-size: 0.9rem;
  box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3);
  animation: pulse-banner 2s infinite;
}

.dev-banner i {
  font-size: 1.1rem;
  animation: spin 4s linear infinite;
}

@keyframes pulse-banner {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Nueva secci√≥n de promoci√≥n */
.promotion-section {
  background: linear-gradient(135deg, #1a2f6b, #2c5282);
  color: white;
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 20px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.promotion-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}

.promotion-header i {
  font-size: 1.5rem;
  color: #ff6b35;
}

.promotion-title {
  font-size: 1.3rem;
  font-weight: 700;
  margin: 0;
}

.promotion-description {
  margin-bottom: 20px;
  line-height: 1.5;
  font-size: 0.95rem;
  opacity: 0.9;
}

.promotion-btn {
  background: #ff6b35;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 50px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.promotion-btn:hover {
  background: #ff914d;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
}

.tabs {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 12px 0;
  overflow-x: auto;
  flex-wrap: nowrap;
}

.tab {
  padding: 10px 16px;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  flex-shrink: 0;
  font-size: 0.9rem;
  text-align: center;
  transition: all 0.2s;
  min-width: 80px;
}

.tab.active {
  background: var(--tab-active-bg);
  color: var(--tab-active-color);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.tab.inactive {
  background: var(--tab-inactive-bg);
  color: var(--tab-inactive-color);
}

.card {
  background: var(--card);
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  overflow: hidden;
  margin-bottom: 18px;
  transition: all 0.3s;
}

.card:hover {
  transform: translateY(-2px);
}

/* NUEVOS ESTILOS PARA ENCABEZADOS UNIFICADOS */
.card-head-unified {
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  color: #fff;
  padding: 16px;
  font-weight: 800;
  text-align: center;
  font-size: 1.1rem;
  border-radius: 16px 16px 0 0;
  letter-spacing: 0.5px;
}

/* Ajuste espec√≠fico para el header de la tabla */
.table-header {
  font-size: 1.2rem;
  font-weight: 900;
  letter-spacing: 0.5px;
}

/* Ajustes para modo oscuro */
[data-theme="dark"] .card-head-unified {
  background: linear-gradient(135deg, #2d3748, #4a5568);
}

.table-wrap {
  overflow-x: auto;
  padding: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}

thead th {
  background: var(--bg);
  padding: 10px;
  text-align: left;
  color: var(--muted);
  font-weight: 700;
  border-bottom: 2px solid var(--bg);
}

tbody td {
  padding: 10px;
  border-bottom: 1px solid var(--bg);
  vertical-align: middle;
}

.currency {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
}

.flag {
  width: 28px;
  height: 18px;
  object-fit: cover;
  border-radius: 3px;
}

.rate {
  font-weight: 700;
  color: var(--brand);
}

[data-theme="dark"] .rate {
  color: var(--rate-color);
}

.trend {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 0.75rem;
}

.trend.up {
  color: #fff;
  background: var(--up);
}

.trend.down {
  color: #fff;
  background: var(--down);
}

.trend.neutral {
  color: #fff;
  background: var(--neutral);
}

/* Estilo para la columna de cambio (negrita) */
.cambio-value {
  font-weight: 700 !important;
}

/* Estilos mejorados para la calculadora */
.calc-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 12px;
}

.calc-input-group {
  grid-column: span 2;
}

.calc-input-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: var(--muted);
  font-size: 0.9rem;
}

.calc-input, .calc-select {
  padding: 12px;
  border-radius: 12px;
  border: 2px solid var(--tab-inactive-bg);
  width: 100%;
  font-weight: 600;
  transition: all 0.2s;
  background: var(--card);
  color: var(--text-primary);
}

.calc-input:focus, .calc-select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
}

.calc-btn {
  grid-column: span 2;
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 14px;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
}

.calc-btn:hover {
  background: #ff914d;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
}

.calc-result {
  grid-column: span 2;
  margin-top: 12px;
  padding: 16px;
  background: var(--bg);
  border-radius: 12px;
  text-align: center;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--brand);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.calc-result small {
  font-size: 0.8rem;
  color: var(--muted);
  font-weight: 500;
}

.conversion-type {
  display: flex;
  gap: 10px;
  margin-bottom: 12px;
}

.conversion-btn {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: 2px solid var(--tab-inactive-bg);
  background: var(--card);
  color: var(--text-primary);
  font-weight: 600;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
}

.conversion-btn.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

/* SECCI√ìN DE INFORMACI√ìN EN FORMA DE NUBE MODERNA - COMPACTA */
.info-cloud {
  background: var(--card);
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 16px;
  position: relative;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.info-cloud::before {
  content: '';
  position: absolute;
  top: -40px;
  right: -20px;
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, rgba(10, 42, 106, 0.08), rgba(255, 107, 53, 0.08));
  border-radius: 50%;
  z-index: 0;
}

.info-cloud::after {
  content: '';
  position: absolute;
  bottom: -30px;
  left: -15px;
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, rgba(255, 107, 53, 0.08), rgba(10, 42, 106, 0.08));
  border-radius: 50%;
  z-index: 0;
}

.info-cloud-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
  position: relative;
  z-index: 1;
}

.info-cloud-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1rem;
  box-shadow: 0 3px 8px rgba(10, 42, 106, 0.2);
}

.info-cloud-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--brand);
  background: linear-gradient(to right, var(--gradient-start), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.info-cloud-content {
  position: relative;
  z-index: 1;
}

.info-cloud-text {
  font-family: 'Roboto Flex', sans-serif;
  line-height: 1.5;
  color: var(--text-secondary);
  margin-bottom: 12px;
  font-size: 0.9rem;
  position: relative;
  padding-left: 16px;
}

.info-cloud-text::before {
  content: '‚Ä¢';
  color: var(--accent);
  font-weight: bold;
  display: inline-block;
  width: 1em;
  margin-left: -1em;
  font-size: 1.1rem;
}

.info-cloud-note {
  background: linear-gradient(to right, rgba(255, 107, 53, 0.08), rgba(10, 42, 106, 0.08));
  border-left: 3px solid var(--accent);
  padding: 12px;
  border-radius: 0 10px 10px 0;
  margin-top: 16px;
  position: relative;
  z-index: 1;
  font-size: 0.85rem;
}

.info-cloud-note strong {
  color: var(--accent);
  font-weight: 700;
}

/* Footer mejorado */
footer {
  text-align: center;
  color: var(--muted);
  font-size: 0.8rem;
  margin-top: 12px;
  padding: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
}

footer .update-info {
  display: flex;
  align-items: center;
  gap: 4px;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid var(--tab-inactive-bg);
}

.setting-label {
  font-weight: 500;
  color: var(--text-primary);
}

.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--accent);
}

input:checked + .slider:before {
  transform: translateX(26px);
}

/* Secci√≥n de compartir - MEJORADA Y MINIMALISTA */
.share-section {
  margin: 18px 0;
  text-align: center;
}

.share-content {
  background: var(--card);
  padding: 16px;
  border-radius: 16px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.share-title {
  font-size: 0.95rem;
  color: var(--muted);
  margin-bottom: 14px;
  font-weight: 600;
}

.share-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.share-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  position: relative;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
}

.share-btn:hover {
  transform: translateY(-3px) scale(1.1);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.18);
}

.share-btn.whatsapp {
  background: linear-gradient(135deg, #25D366, #128C7E);
  color: white;
}

.share-btn.facebook {
  background: linear-gradient(135deg, #3b5998, #1877F2);
  color: white;
}

.share-btn.messenger {
  background: linear-gradient(135deg, #0084ff, #00c6ff);
  color: white;
}

.share-btn.telegram {
  background: linear-gradient(135deg, #0088cc, #2AABEE);
  color: white;
}

.share-btn.link {
  background: linear-gradient(135deg, #6b7280, #9ca3af);
  color: white;
}

.share-btn .tooltip {
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.7rem;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
}

.share-btn:hover .tooltip {
  opacity: 1;
  visibility: visible;
  bottom: -25px;
}

/* Estilos para los gr√°ficos */
.chart-container {
  padding: 12px;
  position: relative;
  height: 220px;
  width: 100%;
}

/* ESTILOS PARA EL SISTEMA DE ANUNCIOS MODIFICADO */
.ad-container {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  z-index: 1001;
  overflow: hidden;
  display: none;
  animation: slideDown 0.5s ease-out;
  border-left: 5px solid #3498db;
}

@keyframes slideDown {
  from { transform: translate(-50%, -100px); opacity: 0; }
  to { transform: translate(-50%, 0); opacity: 1; }
}

.ad-header {
  background: #f8f9fa;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #eee;
  position: relative;
}

.ad-header h3 {
  color: #2c3e50;
  font-size: 1.2rem;
  margin: 0;
}

.close-ad {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #999;
  display: none;
}

.close-ad:hover {
  color: #333;
}

.countdown-timer {
  position: absolute;
  right: 15px;
  background: #ff6b35;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 0.9rem;
}

.ad-content {
  padding: 20px;
}

.ad-title {
  font-size: 1.4rem;
  color: #2c3e50;
  margin-bottom: 15px;
  text-align: center;
}

.ad-image {
  width: 100%;
  height: 180px;
  background-color: #f0f0f0;
  border-radius: 8px;
  margin-bottom: 15px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ad-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.ad-description {
  color: #666;
  margin-bottom: 15px;
  line-height: 1.5;
  text-align: center;
}

.ad-cta {
  display: inline-block;
  background: #3498db;
  color: white;
  padding: 12px 24px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: bold;
  transition: background 0.3s;
  width: 100%;
  text-align: center;
}

.ad-cta:hover {
  background: #2980b9;
}

.ad-footer {
  padding: 10px 20px;
  background: #f8f9fa;
  text-align: right;
  font-size: 0.9rem;
  color: 888;
  border-top: 1px solid #eee;
}

/* Clase para bloquear el scroll cuando el anuncio est√° abierto */
.body-no-scroll {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

/* ===== NUEVOS ESTILOS PARA LOS ENCABEZADOS ===== */

/* Estilos para el encabezado de la tabla - TASA DE CAMBIO HOY */
.table-header-modified {
  text-align: center;
  font-size: 1.4rem;
  font-weight: 900;
  color: #6b46c1; /* Morado principal */
  padding: 2px;
  background: linear-gradient(135deg, rgba(107, 70, 193, 0.15), rgba(165, 122, 247, 0.1));
  border-radius: 4px;
  margin: 12px 0;
  position: relative;
  overflow: hidden;
}

.table-header-modified::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(159, 122, 234, 0.3), transparent);
  transform: translateX(-100%);
  animation: highlight 3s ease-in-out infinite;
}

@keyframes highlight {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Estilos para encabezados con dise√±o de nube COMPACTO */
.card-head-cloud {
  background: var(--card);
  border-radius: 12px;
  padding: 12px 16px;
  margin: 0 0 12px 0;
  position: relative;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  border: 2px solid rgba(107, 70, 193, 0.15);
  display: flex;
  align-items: center;
  gap: 12px;
}

.card-head-cloud::before {
  content: '';
  position: absolute;
  top: -20px;
  right: -15px;
  width: 70px;
  height: 70px;
  background: linear-gradient(135deg, rgba(107, 70, 193, 0.08), rgba(165, 122, 247, 0.08));
  border-radius: 50%;
  z-index: 0;
}

.card-head-cloud::after {
  content: '';
  position: absolute;
  bottom: -15px;
  left: -10px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, rgba(165, 122, 247, 0.08), rgba(107, 70, 193, 0.08));
  border-radius: 50%;
  z-index: 0;
}

.card-head-cloud-content {
  position: relative;
  z-index: 1;
  display: flex;
  align-items: center;
  width: 100%;
  justify-content: space-between;
}

.card-head-cloud-icon {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, var(--purple-primary), var(--purple-light));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(107, 70, 193, 0.3);
  flex-shrink: 0;
}

.card-head-cloud-title {
  font-size: 1rem;
  font-weight: 900;
  color: var(--purple-primary);
  text-align: center;
  flex-grow: 1;
  padding-right: 10px;
}

/* Ajustes para modo oscuro */
[data-theme="dark"] .card-head-cloud {
  border-color: rgba(159, 122, 234, 0.2);
}

[data-theme="dark"] .table-header-modified {
  background: rgba(159, 122, 234, 0.15);
}

/* ===== FIN NUEVOS ESTILOS ===== */

@media(max-width:480px){
  .rate {
    font-size: 0.8rem;
  }
  
  .flag {
    width: 24px;
    height: 16px;
  }
  
  .tab {
    padding: 8px 12px;
    font-size: 0.8rem;
    min-width: 70px;
  }
  
  .calc-container {
    grid-template-columns: 1fr;
  }
  
  .calc-input-group, .calc-btn, .calc-result {
    grid-column: span 1;
  }
  
  .conversion-type {
    flex-direction: column;
  }
  
  .logo .name {
    font-size: 1.2rem;
  }
  
  .floating-users {
    bottom: 15px;
    right: 15px;
    font-size: 0.8rem;
    padding: 8px 12px;
  }
  
  .user-count {
    font-size: 1rem;
  }
  
  .dev-banner {
    font-size: 0.8rem;
    padding: 8px 12px;
  }
  
  .share-buttons {
    gap: 10px;
  }
  
  .share-btn {
    width: 45px;
    height: 45px;
    font-size: 1.1rem;
  }
  
  .info-cloud {
    padding: 16px;
  }
  
  .info-cloud-title {
    font-size: 1rem;
  }
  
  .info-cloud-icon {
    width: 36px;
    height: 36px;
    font-size: 0.9rem;
  }
  
  .info-cloud-text {
    font-size: 0.85rem;
    padding-left: 14px;
  }
  
  header {
    padding: 14px 16px;
    margin: 0 8px;
    max-width: calc(100% - 16px);
  }
  
  .logo-img {
    width: 36px;
    height: 36px;
  }
  
  .logo-img img {
    width: 36px;
    height: 36px;
  }
  
  .clock-box .clock {
    padding: 6px 12px;
    font-size: 1rem;
  }
  
  .chart-container {
    height: 200px;
  }
  
  /* Ajustes responsivos para anuncios */
  .ad-container {
    width: 95%;
  }
  
  .ad-image {
    height: 150px;
  }
  
  /* Ajustes para la secci√≥n de promoci√≥n */
  .promotion-section {
    padding: 15px;
  }
  
  .promotion-title {
    font-size: 1.1rem;
  }
  
  .promotion-description {
    font-size: 0.85rem;
  }
  
  .promotion-btn {
    padding: 10px 18px;
    font-size: 0.9rem;
  }
  
  /* Ajustes para encabezados unificados en m√≥viles */
  .card-head-unified {
    padding: 14px;
    font-size: 1rem;
  }
  
  .table-header {
    font-size: 1.1rem;
  }
  
  /* Ajustes para nuevos encabezados en m√≥viles */
  .table-header-modified {
    font-size: 1.2rem;
    padding: 10px;
  }
  
  .card-head-cloud {
    padding: 10px 12px;
  }
  
  .card-head-cloud-icon {
    width: 28px;
    height: 28px;
    font-size: 0.8rem;
  }
  
  .card-head-cloud-title {
    font-size: 0.9rem;
  }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-img"><img src="https://divisascu.vercel.app/logo.png" alt="DivisasCU Logo"></div>
    <div>
      <div class="name">DivisasCU</div>
      <div class="small">MercadoInformal</div>
    </div>
  </div>
  <div class="controls">
    <div class="clock-box">
      <div class="title">Time</div>
      <div id="clock" class="clock">00<span class="blink">:</span>00<span class="ampm"> AM</span></div>
    </div>
  </div>
</header>

<!-- Bot√≥n flotante de usuarios en l√≠nea -->
<div class="floating-users">
  <i class="fas fa-users"></i> <span>En linea:</span> <span id="onlineUsers" class="user-count">23</span>
</div>

<div class="wrap">
  <!-- Banner de desarrollo -->
  <div class="dev-banner">
    <i class="fas fa-cog"></i>
    <span>Sitio Web en Desarrollo</span>
  </div>

  <!-- Nueva secci√≥n de promoci√≥n -->
  <div class="promotion-section">
    <div class="promotion-header">
      <i class="fas fa-bullhorn"></i>
      <h2 class="promotion-title">Promociona tu negocio aqu√≠</h2>
    </div>
    <p class="promotion-description">Potencie su negocio con anuncios estrat√©gicos en nuestra web de alto tr√°fico. Llevamos su mensaje directo a su audiencia ideal aumentando su visibilidad. No dude en escribirnos.</p>
    <a href="mailto:divisascubanas@gmail.com?subject=Promoci√≥n de negocio&body=Hola, me interesa promocionar mi negocio en DivisasCU" class="promotion-btn">
      <i class="fas fa-envelope"></i> Contactar
    </a>
  </div>

  <div class="tabs">
    <div id="tabTableBtn" class="tab active">TABLA</div>
    <div id="tabChartBtn" class="tab inactive">GRAFICOS</div>
    <div id="tabCalcBtn" class="tab inactive">CALCULADORA</div>
    <div id="tabSettingsBtn" class="tab inactive"><i class="fas fa-cog"></i></div>
  </div>

  <!-- Tabla -->
  <div id="tabTable" class="card">
    <div class="table-wrap">
      <table id="ratesTable">
        <thead>
          <tr>
            <th colspan="4" class="table-header-modified">‚Ä¢ TASAS DE CAMBIO ACTUAL ‚Ä¢</th>
          </tr>
          <tr><th>MONEDA</th><th>CUP</th><th>CAMBIO</th><th>TENDENCIA</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Charts -->
  <div id="tabChart" class="card" style="display:none">
    <div class="card-head-cloud">
      <div class="card-head-cloud-content">
        <div class="card-head-cloud-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <h2 class="card-head-cloud-title">GR√ÅFICOS PRINCIPALES</h2>
      </div>
    </div>
    <div class="chart-container">
      <canvas id="lineChart"></canvas>
    </div>
  </div>

  <!-- Calculadora mejorada -->
  <div id="tabCalc" class="card" style="display:none">
    <div class="card-head-cloud">
      <div class="card-head-cloud-content">
        <div class="card-head-cloud-icon">
          <i class="fas fa-calculator"></i>
        </div>
        <h2 class="card-head-cloud-title">CALCULADORA</h2>
      </div>
    </div>
    <div class="calc-container">
      <div class="conversion-type">
        <div class="conversion-btn active" data-type="toCurrency">CUP ‚Üí Divisa</div>
        <div class="conversion-btn" data-type="toCUP">Divisa ‚Üí CUP</div>
      </div>
      
      <div class="calc-input-group">
        <label for="calcAmount" id="calcAmountLabel">Cantidad en CUP</label>
        <input id="calcAmount" type="number" placeholder="Ej: 1000" class="calc-input" />
      </div>
      
      <div class="calc-input-group">
        <label for="calcCurrency">Selecciona moneda</label>
        <select id="calcCurrency" class="calc-select"></select>
      </div>
      
      <button id="calcBtn" class="calc-btn">
        <i class="fas fa-sync-alt"></i> Convertir
      </button>
      
      <div id="calcResult" class="calc-result">
        <span>Resultado de la conversi√≥n</span>
        <small>Selecciona una cantidad y moneda</small>
      </div>
    </div>
  </div>

  <!-- Configuraci√≥n -->
  <div id="tabSettings" class="card" style="display:none">
    <div class="card-head-cloud">
      <div class="card-head-cloud-content">
        <div class="card-head-cloud-icon">
          <i class="fas fa-cog"></i>
        </div>
        <h2 class="card-head-cloud-title">CONFIGURATION</h2>
      </div>
    </div>
    <div>
      <div class="setting-item">
        <div class="setting-label">Modo oscuro</div>
        <label class="switch">
          <input type="checkbox" id="darkModeToggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <div class="setting-label">Notificaciones de cambios</div>
        <label class="switch">
          <input type="checkbox" id="notificationsToggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <div class="setting-label">Actualizaci√≥n autom√°tica</div>
        <label class="switch">
          <input type="checkbox" id="autoUpdateToggle" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <!-- Information card - Dise√±o moderno tipo nube (m√°s compacto) -->
  <div class="info-cloud">
    <div class="info-cloud-header">
      <div class="info-cloud-icon">
        <i class="fas fa-info-circle"></i>
      </div>
      <h2 class="info-cloud-title">INFORMACI√ìN IMPORTANTE</h2>
    </div>
    
    <div class="info-cloud-content">
      <p class="info-cloud-text">En este sitio encontrar√°s informaci√≥n sobre las tasas de cambio de divisas en Cuba, basada espec√≠ficamente en el mercado informal y en los grupos de compra y venta que operan en todo el pa√≠s.</p>
      
      <p class="info-cloud-text">Te ofrecemos datos actualizados y confiables. Adem√°s, puedes usar nuestra herramienta para calcular de forma f√°cil y segura el valor de tu dinero en diferentes monedas.</p>
      
      <div class="info-cloud-note">
        <strong>NOTA:</strong> Las tasas de cambio pueden variar seg√∫n la regi√≥n y las condiciones del mercado.
      </div>
    </div>
  </div>

  <!-- Secci√≥n de compartir MEJORADA Y MINIMALISTA -->
  <div class="share-section">
    <div class="share-content">
      <div class="share-title">Compartir esta p√°gina en:</div>
      <div class="share-buttons">
        <button class="share-btn whatsapp" onclick="shareOnWhatsApp()">
          <i class="fab fa-whatsapp"></i>
          <span class="tooltip">WhatsApp</span>
        </button>
        <button class="share-btn facebook" onclick="shareOnFacebook()">
          <i class="fab fa-facebook-f"></i>
          <span class="tooltip">Facebook</span>
        </button>
        <button class="share-btn messenger" onclick="shareOnMessenger()">
          <i class="fab fa-facebook-messenger"></i>
          <span class="tooltip">Messenger</span>
        </button>
        <button class="share-btn telegram" onclick="shareOnTelegram()">
          <i class="fab fa-telegram"></i>
          <span class="tooltip">Telegram</span>
        </button>
        <button class="share-btn link" onclick="copyLink()">
          <i class="fas fa-link"></i>
          <span class="tooltip">Copiar enlace</span>
        </button>
      </div>
    </div>
  </div>

  <footer>
    ¬© <strong>divisasCU</strong> ‚Äî 
    <span class="update-info">
      <i class="far fa-calendar-alt"></i> √öltima actualizaci√≥n: <span id="lastDate">--/--/----</span>
    </span>
  </footer>
</div>

<!-- Contenedor de anuncios MODIFICADO -->
<div class="ad-container" id="adContainer">
  <div class="ad-header">
    <h3>Anuncio Patrocinado</h3>
    <button class="close-ad" id="closeAd">&times;</button>
    <div class="countdown-timer" id="countdownTimer">10</div>
  </div>
  <div class="ad-content">
    <h2 class="ad-title" id="adTitle"></h2>
    
    <div class="ad-image">
      <img id="adImage" src="" alt="">
    </div>
    
    <p class="ad-description" id="adDescription"></p>
    
    <a href="#" class="ad-cta" id="adCta" target="_blank"></a>
  </div>
  <div class="ad-footer">
    Anuncio ‚Ä¢ <span id="currentDate"></span>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<!-- Archivo externo con datos de la tabla -->
<script src="tabla.js"></script>
<!-- Archivo externo con datos de anuncios -->
<script src="anuncio.js"></script>
<!-- Archivo externo con datos para gr√°ficos -->
<script src="grafico.js"></script>

<script>
// Variables globales para los datos de la tabla
let rows = [];
let filteredRows = [];
let conversionType = "toCurrency"; // "toCurrency" or "toCUP"

// Variables para el sistema de anuncios
let adInterval;
let countdownInterval;
let countdownValue = 10;

/* Utils */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const fmt = n => {
  const num = Number(n);
  // Mostrar decimales solo cuando son necesarios
  return num % 1 === 0 ? num.toString() : num.toLocaleString("es-ES", {minimumFractionDigits:2,maximumFractionDigits:2});
};

// Funci√≥n para formatear la hora en formato de 12 horas
function formatTime12Hour(date) {
  let hours = date.getHours();
  let minutes = date.getMinutes();
  const ampm = hours >= 12 ? 'PM' : 'AM';
  
  hours = hours % 12;
  hours = hours ? hours : 12; // La hora 0 debe ser 12
  minutes = minutes < 10 ? '0' + minutes : minutes;
  
  return `${hours}:${minutes} ${ampm}`;
}

// Funciones para compartir - MEJORADAS
function shareOnWhatsApp() {
  const text = "üí∞ Consulta las tasas de cambio actualizadas del mercado informal de divisas en Cuba. DivisasCU - Mercado Informal";
  const url = window.location.href;
  const encodedText = encodeURIComponent(text + " " + url);
  window.open(`https://api.whatsapp.com/send?text=${encodedText}`, '_blank');
}

function shareOnFacebook() {
  const url = encodeURIComponent(window.location.href);
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnMessenger() {
  const url = encodeURIComponent(window.location.href);
  window.open(`fb-messenger://share/?link=${url}`, '_blank');
}

function shareOnTelegram() {
  const text = "üí∞ Consulta las tasas de cambio actualizadas del mercado informal de divisas en Cuba. DivisasCU - Mercado Informal";
  const url = window.location.href;
  const encodedText = encodeURIComponent(text + " " + url);
  window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
}

function copyLink() {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    // Mostrar notificaci√≥n de enlace copiado
    alert("Enlace copiado al portapapeles");
  }).catch(err => {
    console.error('Error al copiar el enlace: ', err);
  });
}

function tickClock(){
  const now = new Date();
  const timeStr = formatTime12Hour(now);
  $("#clock").innerHTML = timeStr.replace(':', '<span class="blink">:</span>');
  $("#lastDate").textContent = now.toLocaleDateString('es-ES',{day:'2-digit',month:'2-digit',year:'numeric'});
  
  // Actualizar la fecha en el anuncio
  $("#currentDate").textContent = now.toLocaleDateString('es-ES', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
}
setInterval(tickClock,1000); tickClock();

// Simulaci√≥n de usuarios en l√≠nea
function simulateOnlineUsers() {
  const baseUsers = 23;
  const now = new Date();
  const hour = now.getHours();
  const dayOfWeek = now.getDay();
  
  // Variaci√≥n seg√∫n hora del d√≠a (m√°s usuarios en horario laboral)
  let hourFactor = 1;
  if (hour >= 9 && hour <= 17) {
    hourFactor = 1.5; // Horario laboral: m√°s usuarios
  } else if (hour >= 18 && hour <= 22) {
    hourFactor = 1.2; // Tarde: usuarios moderados
  } else {
    hourFactor = 0.7; // Noche/madrugada: menos usuarios
  }
  
  // Variaci√≥n seg√∫n d√≠a de la semana (m√°s usuarios entre semana)
  let dayFactor = 1;
  if (dayOfWeek >= 1 && dayOfWeek <= 5) {
    dayFactor = 1.3; // D√≠as laborables: m√°s usuarios
  } else {
    dayFactor = 0.8; // Fin de semana: menos usuarios
  }
  
  // Variaci√≥n aleatoria (peque√±as fluctuaciones)
  const randomFactor = 0.9 + (Math.random() * 0.2);
  
  // C√°lculo final
  let users = Math.round(baseUsers * hourFactor * dayFactor * randomFactor);
  
  // Asegurar que no sea menor a 5
  users = Math.max(5, users);
  
  // Actualizar el contedor
  $("#onlineUsers").textContent = users;
}

// Iniciar simulaci√≥n de usuarios
setInterval(simulateOnlineUsers, 5000);
simulateOnlineUsers(); // Ejecutar inmediatamente

function renderTable(){
  const tbody = $("#ratesTable tbody");
  tbody.innerHTML = "";
  filteredRows.forEach(r => {
    // Asegurar que los signos + y - se muestren correctamente
    let cambioTexto = "";
    if (r.delta > 0) {
      cambioTexto = `+${fmt(r.delta)}`;
    } else if (r.delta < 0) {
      cambioTexto = `-${fmt(Math.abs(r.delta))}`;
    } else {
      cambioTexto = "=";
    }
    
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><div class="currency"><img class="flag" src="${r.flag}" alt="${r.code}"> ${r.label}</div></td>
      <td class="rate">${fmt(r.rate)}</td>
      <td class="cambio-value">${cambioTexto}</td>
      <td><div class="trend ${r.trend}"><i class="fa-solid ${r.trend==="up"?"fa-arrow-up":r.trend==="down"?"fa-arrow-down":"fa-equals"}"></i> ${r.trend==="up"?"Subiendo":r.trend==="down"?"Bajando":"Estable"}</div></td>
    `;
    tbody.appendChild(tr);
  });
}

/* Calculadora */
function refreshCalcOptions(){
  const sel = $("#calcCurrency");
  sel.innerHTML="";
  rows.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r.code; 
    opt.textContent = `${r.code} ‚Äî ${fmt(r.rate)} CUP`; 
    sel.appendChild(opt);
  });
}

$("#calcBtn").addEventListener("click",() => {
  const amt = Number($("#calcAmount").value || 0);
  const code = $("#calcCurrency").value;
  const r = rows.find(x => x.code === code);
  if (!r || !amt || amt <= 0) {
    $("#calcResult").innerHTML = `<span>Resultado de la conversi√≥n</span><small>Introduce una cantidad v√°lida</small>`;
    return;
  }
  
  let result, explanation;
  if (conversionType === "toCurrency") {
    // Convertir de CUP a divisa
    result = amt / r.rate;
    explanation = `${fmt(amt)} CUP = ${fmt(result)} ${r.code}`;
  } else {
    // Convertir de divisa a CUP
    result = amt * r.rate;
    explanation = `${fmt(amt)} ${r.code} = ${fmt(result)} CUP`;
  }
  
  $("#calcResult").innerHTML = `
    <span>${explanation}</span>
    <small>Tasa de cambio: 1 ${r.code} = ${fmt(r.rate)} CUP</small>
  `;
});

// Cambiar tipo de conversi√≥n
$$('.conversion-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    $$('.conversion-btn').forEach(b => b.classList.remove('active'));
    e.currentTarget.classList.add('active');
    conversionType = e.currentTarget.getAttribute('data-type');
    
    // Actualizar la etiqueta del campo de cantidad
    const label = $("#calcAmountLabel");
    if (conversionType === "toCurrency") {
      label.textContent = "Cantidad en CUP";
      $("#calcAmount").placeholder = "Ej: 1000";
    } else {
      label.textContent = "Cantidad en divisa";
      $("#calcAmount").placeholder = "Ej: 100";
    }
    
    // Limpiar resultado
    $("#calcResult").innerHTML = `<span>Resultado de la conversi√≥n</span><small>Selecciona una cantidad y moneda</small>`;
  });
});

// Tambi√©n convertir al presionar Enter
$("#calcAmount").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    $("#calcBtn").click();
  }
});

// Modo oscuro
$("#darkModeToggle").addEventListener("change", (e) => {
  if (e.target.checked) {
    document.documentElement.setAttribute('data-theme', 'dark');
    localStorage.setItem('theme', 'dark');
  } else {
    document.documentElement.removeAttribute('data-theme');
    localStorage.setItem('theme', 'light');
  }
});

/* Charts */
let lineChart;

function updateChart(){
  const ctx = $("#lineChart").getContext("2d");
  
  // Obtener datos para las 3 primeras monedas
  const datasets = rows.slice(0, 3).map((r, i) => {
    // Buscar datos hist√≥ricos para esta moneda
    let datosHistoricos = [];
    
    if (typeof graficoData !== 'undefined') {
      const monedaData = graficoData.find(m => m.code === r.code);
      if (monedaData) {
        // Obtener √∫ltimos 7 d√≠as
        const ultimosDatos = obtenerUltimosDias(r.code, 7);
        datosHistoricos = ultimosDatos.valores;
        
        // Formatear fechas para mostrar en el gr√°fico
        const labels = ultimosDatos.fechas.map(f => {
          const fecha = new Date(f);
          return fecha.toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit'});
        });
        
        // Actualizar las etiquetas del gr√°fico si es la primera moneda
        if (i === 0) {
          Chart.defaults.font.family = 'Inter, system-ui, Arial';
          lineChart.data.labels = labels;
        }
      }
    }
    
    // Si no hay datos hist√≥ricos, usar datos simulados como respaldo
    if (datosHistoricos.length === 0) {
      datosHistoricos = Array.from({length: 7}, (_, j) => 
        Number((r.rate * (1 + (Math.sin((j+1)*1.2+i)/100))).toFixed(2))
      );
    }
    
    return {
      label: r.label, 
      data: datosHistoricos, 
      tension: 0.3, 
      borderWidth: 2,
      borderColor: ['#3B82F6', '#EF4444', '#10B981'][i],
      backgroundColor: ['#3B82F6', '#EF4444', '#10B981'][i] + '20'
    };
  });
  
  if(lineChart) lineChart.destroy();
  
  // Si no hay etiquetas, usar las predeterminadas
  const labels = lineChart && lineChart.data.labels ? lineChart.data.labels : 
                Array.from({length: 7}, (_, i) => {
                  const d = new Date();
                  d.setDate(d.getDate() - (6-i));
                  return d.toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit'});
                });
  
  lineChart = new Chart(ctx, {
    type: 'line', 
    data: {labels, datasets}, 
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20
          }
        }
      },
      scales: {
        y: {
          beginAtZero: false,
          grid: {
            color: 'rgba(0, 0, 0, 0.1)'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}

// Funci√≥n para actualizar los valores diarios (debe llamarse manualmente)
function actualizarValorDiario(codigoMoneda, valor) {
  if (typeof graficoData === 'undefined' || typeof agregarValorDiario === 'undefined') {
    console.error("El archivo grafico.js no est√° cargado correctamente");
    return;
  }
  
  const fechaHoy = new Date().toISOString().split('T')[0]; // Formato YYYY-MM-DD
  agregarValorDiario(codigoMoneda, fechaHoy, valor);
  
  // Si el gr√°fico est√° visible, actualizarlo
  if ($("#tabChart").style.display !== "none") {
    updateChart();
  }
  
  console.log(`Valor actualizado para ${codigoMoneda}: ${valor} en fecha ${fechaHoy}`);
}

/* Tabs */
function setActiveTab(tab){
  // Ocultar todos los contenidos
  $("#tabTable").style.display = "none";
  $("#tabChart").style.display = "none";
  $("#tabCalc").style.display = "none";
  $("#tabSettings").style.display = "none";
  
  // Mostrar u ocultar el anuncio informativo seg√∫n la pesta√±a
  if (tab === "table") {
    document.querySelector('.info-cloud').style.display = 'block';
    document.querySelector('.share-section').style.display = 'block';
  } else {
    document.querySelector('.info-cloud').style.display = 'none';
    document.querySelector('.share-section').style.display = 'none';
  }
  
  // Restablecer estado de todos los tabs
  $$(".tab").forEach(t => {
    t.classList.remove("active");
    t.classList.add("inactive");
  });
  
  // Activar el tab seleccionado
  if(tab === "table"){
    $("#tabTable").style.display = "block";
    $("#tabTableBtn").classList.remove("inactive");
    $("#tabTableBtn").classList.add("active");
  }
  else if(tab === "chart"){
    $("#tabChart").style.display = "block";
    $("#tabChartBtn").classList.remove("inactive");
    $("#tabChartBtn").classList.add("active");
    updateChart();
  }
  else if(tab === "calc"){
    $("#tabCalc").style.display = "block";
    $("#tabCalcBtn").classList.remove("inactive");
    $("#tabCalcBtn").classList.add("active");
    refreshCalcOptions();
  }
  else if(tab === "settings"){
    $("#tabSettings").style.display = "block";
    $("#tabSettingsBtn").classList.remove("inactive");
    $("#tabSettingsBtn").classList.add("active");
  }
}

$("#tabTableBtn").addEventListener("click", () => setActiveTab("table"));
$("#tabChartBtn").addEventListener("click", () => setActiveTab("chart"));
$("#tabCalcBtn").addEventListener("click", () => setActiveTab("calc"));
$("#tabSettingsBtn").addEventListener("click", () => setActiveTab("settings"));

/* SISTEMA DE ANUNCIOS MODIFICADO */
// Elementos DOM para anuncios
const adContainer = document.getElementById('adContainer');
const adTitle = document.getElementById('adTitle');
const adDescription = document.getElementById('adDescription');
const adCta = document.getElementById('adCta');
const closeAd = document.getElementById('closeAd');
const countdownTimer = document.getElementById('countdownTimer');

// Funci√≥n para bloquear/desbloquear el scroll
function toggleBodyScroll(lock) {
  if (lock) {
    document.body.classList.add('body-no-scroll');
  } else {
    document.body.classList.remove('body-no-scroll');
  }
}

// Iniciar cuenta regresiva
function startCountdown() {
  countdownValue = 10;
  countdownTimer.textContent = countdownValue;
  countdownTimer.style.display = 'flex';
  closeAd.style.display = 'none';
  
  countdownInterval = setInterval(() => {
    countdownValue--;
    countdownTimer.textContent = countdownValue;
    
    if (countdownValue <= 0) {
      clearInterval(countdownInterval);
      countdownTimer.style.display = 'none';
      closeAd.style.display = 'block';
    }
  }, 1000);
}

// Mostrar el anuncio
function showAd() {
  adContainer.style.display = 'block';
  toggleBodyScroll(true); // Bloquear scroll
  startCountdown();
}

// Cerrar el anuncio manualmente
closeAd.addEventListener('click', () => {
  adContainer.style.display = 'none';
  toggleBodyScroll(false); // Desbloquear scroll
});

// Funci√≥n para obtener un anuncio activo aleatorio
function obtenerAnuncioAleatorio() {
  // Verificar si la variable anuncios existe (definida en anuncio.js)
  if (typeof anuncios === 'undefined' || !Array.isArray(anuncios)) {
    console.error("Error: No se pudieron cargar los datos de anuncios");
    return null;
  }
  
  // Filtrar solo anuncios activados
  const anunciosActivos = anuncios.filter(anuncio => anuncio.activado === "si");
  
  // Si no hay anuncios activos, retornar null
  if (anunciosActivos.length === 0) {
    return null;
  }
  
  // Seleccionar un anuncio aleatorio de los activos
  const indiceAleatorio = Math.floor(Math.random() * anunciosActivos.length);
  return anunciosActivos[indiceAleatorio];
}

// Iniciar el sistema de anuncios
function startAdSystem() {
  // Verificar si hay anuncios activos
  const anuncio = obtenerAnuncioAleatorio();
  
  if (!anuncio) {
    console.log("No hay anuncios activos en este momento");
    return;
  }
  
  // Configurar el anuncio
  adTitle.textContent = anuncio.titulo;
  adDescription.textContent = anuncio.descripcion;
  adCta.textContent = anuncio.textoBoton;
  adCta.href = anuncio.enlaceBoton;
  
  // Actualizar la imagen del anuncio
  const adImage = document.querySelector('.ad-image img');
  adImage.src = anuncio.imagen;
  adImage.alt = anuncio.titulo;
  
  // Mostrar el primer anuncio despu√©s de 1 minuto (60000 ms)
  setTimeout(() => {
    showAd();
    
    // Programar anuncios cada 10 minutos (600000 ms)
    adInterval = setInterval(showAd, 600000);
  }, 60000);
}

// Cargar tema desde localStorage al iniciar
document.addEventListener('DOMContentLoaded', () => {
  // Cargar tema
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
    $("#darkModeToggle").checked = true;
  }
  
// Inicializar con los datos del archivo externo
// Verificar si los datos de la tabla est√°n disponibles
if (typeof tableData !== 'undefined' && Array.isArray(tableData)) {
  rows = JSON.parse(JSON.stringify(tableData));
  filteredRows = [...rows];
  renderTable();
  refreshCalcOptions();
} else {
  console.error("Error: No se pudieron cargar los datos de la tabla");
}
  
  // Iniciar el sistema de anuncios
  startAdSystem();
  
  // Inicializar gr√°ficos solo si es necesario
  if (window.innerWidth > 480) {
    updateChart();
  }
});

// Actualizar gr√°ficos al redimensionar la ventana
window.addEventListener('resize', function() {
  if ($("#tabChart").style.display !== "none") {
    updateChart();
  }
});
</script>
</body>
</html>
